<html>
    <head>
        <title>When Map Met Blog&hellip;</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
        integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
        crossorigin=""/>
        <style>
            body {
                padding: 0;
                margin: 0;
            }
            iframe {
                border: none;
                display: block;
                width: 100%;
                height: 100%;
            }
            #left {
                float: left;
                width: 50%;
                height: 100%;
                overflow: hidden;
            }
            #right {
                overflow: hidden;
            }
            .info {
                padding: 6px 8px;
                font: 14px/16px Arial, Helvetica, sans-serif;
                background: white;
                background: rgba(255,255,255,0.8);
                box-shadow: 0 0 15px rgba(0,0,0,0.2);
                border-radius: 5px;
            }
            .legend {
                line-height: 18px;
                color: #555;
            }
            .legend i {
                width: 18px;
                height: 18px;
                float: left;
                margin-right: 8px;
                opacity: 0.7;
            }
        </style>
    </head>
<body>
    <div id="left"></div>
    <div id="right">
        <iframe src="https://www.schemebasedadventure.com/2018/12/27/this-is-not-a-test/"></iframe>
    </div>

    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
    integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
    crossorigin=""></script>
    <!-- <script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.3.0"></script> -->
    <script type="text/javascript" src="https://stamen-maps.a.ssl.fastly.net/js/tile.stamen.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="js/Leaflet.Geodesic.js" charset="UTF-8"></script> <!-- from https://github.com/henrythasler/Leaflet.Geodesic -->
    <script src="js/svg-icon.js"></script> <!-- from https://github.com/iatkin/leaflet-svgicon -->
    <script src="js/entries.js"></script> <!-- Load list of entries from external file -->
    <script>
        var map = L.map('left');//.setView([51.505, -0.09], 13);
        var watercolor = new L.StamenTileLayer("watercolor");
        var terrain = new L.StamenTileLayer('terrain');
        var toner = new L.StamenTileLayer('toner');
        map.addLayer(watercolor);

        var latest = d3.max(entries, function(d) { return new Date(d.date); })
        
        function addMonths(date, months) {
            myDate = new Date(date);
            myDate.setMonth(myDate.getMonth() + months);
            return myDate;
        }
        
        var colorScale = d3.scaleLinear()
            .domain([addMonths(latest, -1), latest]) // Fade up from the lightest value to the darkest starting a month before the latest entry
            .interpolate(d3.interpolateHcl)
            .clamp(true) // so that older entries don't fade to an even lighter shade
            .range([d3.rgb('#a1d99b'), d3.rgb('#00441b')]); // greens
            // .range([d3.rgb("#fc8d59"), d3.rgb('#7f0000')]); // oranges
        
        if (entries.length > 1) { // If there are multiple entries, draw lines between consecutive entries
            var lines = [], 
                linesGroup = L.featureGroup();

            for (var i = 1; i < entries.length; i++) { // create a list of lines
                lines.push({ latlngs: [entries[i - 1].latlng, entries[i].latlng], date: entries[i].date });
            };
            lines.forEach(function(d) {
                let steps = Math.ceil(L.latLng(d.latlngs[0]).distanceTo(L.latLng(d.latlngs[1])) / 400000); // one segment per 400km should be sufficient
                L.geodesic([d.latlngs], { color: colorScale(new Date(d.date)), steps: steps, wrap: false, opacity: 0.8 })
                .addTo(linesGroup);
            });
            map.addLayer(linesGroup);
        };
        
        var pointsGroup = L.featureGroup();
        entries.forEach(function(d){
            new L.Marker.SVGMarker(d.latlng, { iconOptions: { color: colorScale(new Date(d.date)), circleRatio: 0, zoom: d.zoom }})
            .bindTooltip("<strong>" + d.title + "</strong><br>" + d.location + "<br>" + d.date)
            .on('click', function(e) { 
                let zoomDist = d.zoom - map.getZoom();
                if(zoomDist > 5) { // Lines can get too big and cover the map during flyTo - avoid this by temporarily removing them
                    map.removeLayer(linesGroup); 
                    map.once('moveend', function() {
                        map.addLayer(linesGroup); 
                    });
                };
                map.flyTo(e.latlng, d.zoom, { duration: 0.5 + 0.1 * Math.abs(zoomDist) });
            })
            .addTo(pointsGroup);
        });
        
        map.addLayer(pointsGroup);
        map.fitBounds(pointsGroup.getBounds());//.pad(0.1));

        var baseMaps = {
            'Watercolor': watercolor,
            'Terrain': terrain,
            'Toner': toner
        };

        L.control.layers(baseMaps).addTo(map);
        var legend = L.control({position: 'bottomright'});

        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend'),
                grades = [],
                labels = ['Newer', '', '', '', 'Older'];

            for (var i = 0; i < 5; i++) {
                grades.push(new Date(latest.getTime() - (latest - addMonths(latest, -1)) * i / 4));
            }

            // loop through our density intervals and generate a label with a colored square for each interval
            for (var i = 0; i < grades.length; i++) {
                div.innerHTML += '<i style="background:' + colorScale(grades[i]) + '"></i> ' + labels[i] + '<br>';
            }

            return div;
        };

        legend.addTo(map);
        </script>
</body>
</html>